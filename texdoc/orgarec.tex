%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Preamble for defining document properties
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\include{preamble}

\graphicspath{{images/}}

% begin latex document
\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title page
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\include{cover}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Dedication page
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\include{dedication}

% Start roman numbering
\pagenumbering{roman} \setcounter{page}{1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SECTION : TABLE OF CONTENT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\renewcommand{\contentsname}{Table of Contents}
\tableofcontents
\clearpage
\thispagestyle{empty}
\cleardoublepage

% Set to arabic numbering after this
\pagenumbering{arabic} \setcounter{page}{1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SECTION : INTRODUCTION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Introduction}
\section{About}
This project's original motivation was to explore the study plans proposed by each section based on actual student choices -- analysing what course students took -- instead of the standard course prerequisites and descriptions that are generally available, and to offer a tool to allow anybody to take a look at the data for himself.

To do so required two important steps:
\begin{itemize}
\item Represent the students study history with a useful model;
\item Find good visual representations for the available data.
\end{itemize}

Both steps were achieved and solid foundations were lain to enable the implementation of new visualisations.

\newpage
\section{Project Directory Structure}
We use sbt to build the code, and hence stick to its structure. Furthermore, the \verb|view|, \verb|core| and \verb|import| segments of the application each live in their own sbt sub-project.

The relevant directories are listed hereafter:

\dirtree{%
.0 .
.1 core/.
.2 src/main/.
.3 scala/.
.4 ch/epfl/recom.
.5 graph/.
.5 model/.
.6 administration/.
.5 processing/.
.6 maps/.
.7 assist/.
.5 storage/.
.6 db/.
.6 maps/.
.5 util/.
.3 plpgsql/.
.3 sqlview/.
.1 import/.
.2 src/main/scala/.
.3 ch/epfl/craft/recom/dimport/isa/.
.1 view/.
.2 src/main/scala/.
.3 ch/epfl/craft/recom/.
.4 view/.
.5 model/.
.5 snippet/.
.6 draw/.
.5 util/.
.5 view/.
}

\chapter{Model}
The model is built around the students and their course history, and this is reflected at the database level. Whenever going through the model is useless (most of the cases that were implemented), the data is accessed and processed directly through stored procedures.

For further in-depth data-mining where individual course histories must be analysed, we believe the model will prove useful.

\section{Classes}
A few of the main classes are mentioned hereafter. They are meant to give you a glimpse of the model: for any of the classes referenced within, please refer to the project's Scaladoc\footnote{\url{http://shastick.github.com/orgarec/doc/core/\#package}}.
and to the source code\footnote{\url{https://github.com/Shastick/orgarec}}.
\begin{multicols}{2}
\begin{lstlisting}[language=Scala]
class Topic(
    val id: String,
    val name: String,
    val section: Section,
    val prerequisites_id: Set[Topic.TopicID],
    val description: 
    	Option[String],
    val credits: Option[Int]
)
\end{lstlisting}

\begin{lstlisting}[language=Scala]
class Student(
    val id: Student.StudentID,
    val arrival: AcademicSemester,
    val section: Option[Section],
    val currentSemester: Option[AcademicSemester],
    val semesterHistory: Set[AcademicSemester],
    val courses: Set[TakenCourse]   
)
\end{lstlisting}

\columnbreak
\begin{lstlisting}[language=Scala]
class Course(
    id: String,
    name: String,
    section: Section,
    prerequisites_id: Set[Topic.TopicID],
    description: Option[String],
    credits: Option[Int],
    val semester: Semester,
    val head: Head
) extends Topic
\end{lstlisting}
\begin{lstlisting}[language=Scala]
case class TakenCourse(course: Course,
    count: Int,
    grade: Option[Int],
    evaluation: Option[Int],
    semester: AcademicSemester
)
\end{lstlisting}

\end{multicols}

\section{Database Structure}
The storage layer and structure are mainly defined through Lift's Mapper. Only for the processing and data extraction have stored procedures been written, and tables added manually. Figure~\ref{fig:db_schema} shows the database schema.

To avoid confusion with class names, the database entities representing objects are suffixed with \verb|map|: a \verb|Student| object is stored in the \verb|studentmap| table.

\begin{figure}
\center
\includegraphics[angle=-90, width=.85\columnwidth]{schema_extended.png}
\caption{database schema}
\label{fig:db_schema}
\end{figure}

\subsection{Stored Procedures}
The following stored procedures are already available:
\paragraph{computeCostudents}
Populates the \verb|courserelationmap| table with the co-students count between any two courses.

\paragraph{sectionperTopicDetail} Gets details about section participation in each topic given by a section and during which academic level.

Example: \verb|SELECT sectionPerTopicDetail| ('{SHS}'::varchar[],'{MA1,MA3}'::varchar[],\\'2012-07-01','2012-07-01')

Returns: the topic isa\_id and name, the section participating in this topic (NOT the one teaching it),
the average participating students from the section and the total number of students in this topic.
these two last numbers are averaged over the number of courses that were considered in the query
(if a span greater that 1 semester is provided, several occurences of the same topic will be counted.) 
students not in the specified academic leves (here: MA1, MA3) are not counted.

\paragraph{sectionTopics} Returns the topics teached by the specified sections

usage: \verb|sectionTopics('{IN,SC}'::varchar[])|

\paragraph{sectionTopicsWStudentCount} Return the topics teached by the specified sections, and the quantity of students that attended during the specified period.

usage: \verb|sectionTopics('{IN,SC}'::varchar[],'2011-07-01','2012-07-01')|

\paragraph{topicCostudentsSemFilter} get the costudents quantity between any two topics taught by the specified sections during the specified time interval and at the specified academic level.

usage : select \verb|topicCostudents|('{SC,IN}'::varchar[],'{BA1}'::varchar[],
'2011-07-01','2012-07-01)

\paragraph{topicCostudents} Get the costudents quantity between two topics taught by the specified section during the specified time interval

usage : select topicCostudents('{SC,IN}'::varchar[],'2011-07-01','2012-07-01)

\paragraph{topicSectionRatio} Returns the sections present in this course and the corresponding ratio. The ratio is averaged over the number of courses that occurred in the given time interval.

usage: select \verb|topicsectionratio(<isa_id>,'2011-07-01','2012-07-01)|

\chapter{Visualisation}

\section{Technology}
The web application and data serving is done in Lift, which is also Scala based, enabling an easy integration with the core.

JavaScript is extensively used for the actual browser-side visualisation.

\section{Implemented visualisations}

\chapter{Import}
The \verb|import| project is quite small, but holds a few key urls where data can be obtained from is-academia. As the interface to access the data is currently evolving, a straightforward importation method has not been implemented.

Scala allows easy basic XML manipulation, and examples can be found in the \verb|ISAxmlImporter| object.

\section{ISA interfaces}
The current interface IS-Academia is actually working on can be found here: \url{https://isanwww1.epfl.ch:8443/site-1.0/}. This is currently a Beta and might hence change quite rapidly.

\subsection{Legacy URLs}
These URLs were used at the beginning of the semester to build the first database draft. It is unclear if they will still be available in the future, and they are available even from the outside of EPFL's network.

\begin{description}
\item[Course list] \url{http://isa.epfl.ch/wsa/cles/ClesInscr}. When called with an argument like "2012-2013", it returns the list of all courses. Example: 
\url{http://isa.epfl.ch/wsa/cles/ClesInscr?invoke=getlistec
les&wwXAnneeacad=2012-2013}

\item[Course information] Data about a specific course can be obtained through \url{http://isa.epfl.ch/wsa/fiches/FichesCours}. Course keys obtained from the course list are of the form \textbf{M}784635267\_\textbf{G}1378361727\_\textbf{P}100304\_\textbf{P}106177\_\textbf{P}132574
where the M stands for \emph{Matiere}, the G for \emph{Groupe} and P for \emph{Professeur}. Such a key is used to grab a \emph{Fiche de cours}: \url{http://isa.epfl.ch/wsa/fiches/FichesCours?invoke=getfiches&wwXMatiere=&wwXAnneeacad=&wwCSection=&wwCNiveau=&wwXCle=M784635267_G1378361727_P100304_P106177_P132574}
\item[Course subscriptions] This interface shows the students subscribed to a given course: \url{http://isa.epfl.ch/wsa/inscr/inscriptions}. Example: \url{http://isa.epfl.ch/wsa/inscr/inscriptions?invoke=getinscriptionsbymatiere&wwXMatiere=&wwXAnneeacad=&wwXSection=&wwXTypesem=&wwXCle=M784635267_G1378361727_P100304_P106177_P132574}
\end{description}


\chapter{Improvements}
\section{Core}
The following parts of the project would deserve further improvements:

\subsection{Database schema}
The schema contains entities that could be merged, namely:

\begin{description}
\item \verb|prerequisite| could be merged into \verb|topicrelationmap|
\item \verb|teaches| and \verb|assists| could be merged into a single entity
\end{description}

\subsection{Data insertion}
Currently, the insertion is done via the Mapper object's \verb|fill()| methods. As objects generally contain many other objects that may also require database insertions or updates, many calls go back and forth between the application and the storage, introducing sensible delays.

This is not a problem as long as import operations do not happen too often: should this requirement change, stored procedures would speed up batch-import operations.

\section{Import}
No proper import procedure exists at the moment. Once IS-Academia proposes a stable and well-defined interface to the required information, a \emph{click-to-import} interface will be a good improvement. 

Another solution could be to work directly with ISA to access their data without the need of an import step.
\chapter{Resources}

\begin{description}
\item[Documentation] :
\begin{description}
 \item[core] \url{http://shastick.github.com/orgarec/doc/core/}
 \item[view] \url{http://shastick.github.com/orgarec/doc/view/}
\end{description}
\item[Source code] \url{https://github.com/Shastick/orgarec}
\item[JavaScript graphing libraries] :

\begin{description}
	\item[d3.js] \url{http://d3js.org/}
	\item[nvd3] \url{http://nvd3.org/}
	\end{description}
	
\end{description}

\end{document}
